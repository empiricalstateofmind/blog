<!DOCTYPE html>
<html lang="en"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Network Dynamics with Python and the Gillespie Algorithm: An Epidemic Example - Andrew Mellor</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="../../../../../images/favicon.png" rel="icon">

<link rel="canonical" href="../../../../../articles/2014/12/19/gillespie-epidemics/">

        <meta name="author" content="Andy Mellor" />
        <meta name="keywords" content="Gillespie,Epidemics,Simulation" />
        <meta name="description" content="The Stochastic Simulation Algorithm (SSA), or Gillespie algorithm, provides a means to sample directly from the state distribution of a system governed by the master equation. Whilst this methodology has been used for the simulation of chemical reactions for decades, its applicability and utility in the simulation of dynamical processes on networks is not well known. We will look at an implementation the Gillespie Algorithm for an epidemic process on an random network, and consider the implementation issues when using the well known Python package, Numpy." />

        <meta property="og:site_name" content="Andrew Mellor" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Network Dynamics with Python and the Gillespie Algorithm: An Epidemic Example"/>
        <meta property="og:url" content="../../../../../articles/2014/12/19/gillespie-epidemics/"/>
        <meta property="og:description" content="The Stochastic Simulation Algorithm (SSA), or Gillespie algorithm, provides a means to sample directly from the state distribution of a system governed by the master equation. Whilst this methodology has been used for the simulation of chemical reactions for decades, its applicability and utility in the simulation of dynamical processes on networks is not well known. We will look at an implementation the Gillespie Algorithm for an epidemic process on an random network, and consider the implementation issues when using the well known Python package, Numpy."/>
        <meta property="article:published_time" content="2014-12-19" />
            <meta property="article:section" content="Dynamical Proccesses" />
            <meta property="article:tag" content="Gillespie" />
            <meta property="article:tag" content="Epidemics" />
            <meta property="article:tag" content="Simulation" />
            <meta property="article:author" content="Andy Mellor" />

    <meta name="twitter:card" content="summary">
    <meta name="twitter:domain" content="../../../../..">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="../../../../../theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="../../../../../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../../../../../theme/css/pygments/default.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../../theme/css/style.css" type="text/css"/>
        <link href="../../../../../static/custom.css" rel="stylesheet">

        <link href="../../../../../feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Andrew Mellor ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../../../../" class="navbar-brand">
Andrew Mellor            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/vitae">Vitae</a></li>
                    <li><a href="/research">Research</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/projects/projects.html">Projects</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="../../../../../archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="../../../../../articles/2014/12/19/gillespie-epidemics/"
                       rel="bookmark"
                       title="Permalink to Network Dynamics with Python and the Gillespie Algorithm: An Epidemic Example">
                        Network Dynamics with Python and the Gillespie Algorithm: An Epidemic Example
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-12-19T00:00:00+01:00"> 19 Dec, 2014</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="../../../../../tag/gillespie.html">Gillespie</a>
        /
	<a href="../../../../../tag/epidemics.html">Epidemics</a>
        /
	<a href="../../../../../tag/simulation.html">Simulation</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <style type="text/css">/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI colors. */
.ansibold {
  font-weight: bold;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  border-left-width: 1px;
  padding-left: 5px;
  background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%);
}
div.cell.jupyter-soft-selected {
  border-left-color: #90CAF9;
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected {
  border-color: #ababab;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%);
}
@media print {
  div.cell.selected {
    border-color: transparent;
  }
}
div.cell.selected.jupyter-soft-selected {
  border-left-width: 0;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%);
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%);
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
@-moz-document url-prefix() {
  div.inner_cell {
    overflow-x: hidden;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell > div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area > div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area > div.highlight > pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  padding: 0.4em;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */
  /* .CodeMirror-lines */
  padding: 0;
  border: 0;
  border-radius: 0;
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area 
div.output_area 
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}



.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}






.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}








.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}


.rendered_html pre,



.rendered_html tr,
.rendered_html th,

.rendered_html td,


.rendered_html * + table {
  margin-top: 1em;
}

.rendered_html * + p {
  margin-top: 1em;
}

.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,

.rendered_html img.unconfined,

div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell > div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered 
.text_cell.unrendered .text_cell_render {
  display: none;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
</style>
<style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
<style type="text/css">
/* Temporary definitions which will become obsolete with Notebook release 5.0 */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The stochastic simulation algorithm (SSA), or Gillespie algorithm, provides a means to sample directly from the state
distribution of a system governed by the master equation. Whilst this methodology has been used for the simulation of chemical
reactions for decades, its applicability and utility in the simulation of dynamical processes on networks is not well known.
We will look at an implementation the Gillespie Algorithm for an epidemic process on an random network, and consider the implementation issues when using Numpy.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Model">The Model<a class="anchor-link" href="#The-Model">¶</a></h2><p>We will look at one of the most simplistic models simple model of epidemic spread, the SI model. An <em>node</em> (person) can either be susceptible (S) or infected (I) with a disease. Nodes are connected along <em>links</em> which describe some interaction between the two bodies for which the disease may possibly travel. For example, our network might contain links between every two people who have passed within 5 metres of each other over a day [1]. Simpler networks could be family ties, coworkers, and coinhabitants if such high resolution data isn't achievable.</p>
<p>The model consists of two reactions,
$$\begin{align} 
    S + I &\xrightarrow{\lambda} I + I,  \\
    S &\xrightarrow{\gamma} I.
    \end{align}$$</p>
<p>A susceptible node can meet an infected node and subsequently become infected itself with some probability (contagion). A susceptible node can also spontaneously become infected by itself (spontaneous infection). This accounts for any chance of becoming infected which is not accounted for in our model otherwise.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">simulation</span> <span class="k">import</span> <span class="n">SI_Simulation</span> <span class="c1"># Import the model.</span>
</pre></div>

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [45]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">erdos_renyi_graph</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span> <span class="c1"># Use Networkx to generate a random graph.</span>
</pre></div>

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [46]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SI_Simulation</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">gam</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">i0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="c1"># Setup the simulation with given parameters.</span>
<span class="n">model</span><span class="o">.</span><span class="n">RunToConvergence</span><span class="p">()</span> <span class="c1"># Run the simulation.</span>
<span class="n">model</span><span class="o">.</span><span class="n">IntegrateSolution</span><span class="p">()</span> <span class="c1"># Numerically integrate the mean field equations.</span>
</pre></div>

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [50]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Simulation.</span>
<span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">times</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Susceptible (sim)&#39;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">times</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">I</span><span class="o">/</span><span class="n">model</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Infected (sim)&#39;</span><span class="p">);</span>

<span class="c1"># Numerical Integration.</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">solution</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Susceptible (approx)&#39;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">solution</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Infected  (approx)&#39;</span><span class="p">);</span>

<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Population Fraction&#39;</span><span class="p">)</span>

<span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.7</span><span class="p">));</span>
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
AAAASUVORK5CYII=
">
</img></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The simulation approximately follows the mean-field prediction[2] which assumes all nodes have the same degree and are identical in their placement in the network. The number of infected follows an S-shaped curve; infection is slow at first and then rapidily increases before slowing towards the final state.</p>
<p>This model and the S-shaped curve has been used in marketing to model the adoption of consumer products from as early as 1969. The <a href="http://en.wikipedia.org/wiki/Bass_diffusion_model">Bass Model</a> as it is called is one of the top 5 most frequently cited papers in the 50-year history of the journal <em>Management Science</em>. One might rightly question why such a simple model has been so well adopted when it is such an oversimplification. Partly the reason is due to the ability to fit parameters to data, or most likely <em>over-fit</em> parameters to data, but that is a different issue entirely!</p>
<p>The literature on epidemic and innovation models is extremely rich and is at a point where any written review of it would be outdated by the time it was finished. For now we'll look at how to simulate these models on a network.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Gillespie">Gillespie<a class="anchor-link" href="#Gillespie">¶</a></h2><p>The <a href="http://en.wikipedia.org/wiki/Gillespie_algorithm">Gillespie algorithm</a>, or the stochastic simulation algorithm
(SSA) was first introduced in 1976 as a means of
providing statistically exact simulations of reacting chemical
species within a reaction volume. There are also
a number of improvements and approximations which have
been suggested, the most famous of which are the Gibson-Bruck algorithm[3] and the Tau-leap approximation[4].</p>
<p>Traditional simulation methods are <em>interval</em>-driven; they
choose a small time step $\Delta t$ and consider whether a reaction
happens in the interval $[t, t + \Delta t)$. These types of simulations
come in two different flavours, synchronous updating
where each node has a chance to react during an interval and
asynchronous updating, where a individual node is chosen at
random and then given the possibility to react. Interestingly
enough, these two simulation schemes can give different results
depending on the dynamics at play. One also has
to take into consideration the length of time step which can
have considerable effects on the reliability of the results however
it is possible to choose these values sensibly to reduce
error. Another caveat of interval
methods is that they can be extremely computationally inefficient. There may be multiple intervals computed before
a reaction takes place, especially if the rate of reaction is
small. This means that multiple random numbers are generated
which have no effect on the system. In practice, the
time interval is chosen such that the expected number of reactions
in an interval is one however this requires the interval
length to be adjusted as the simulation evolves and reaction
propensities change.</p>
<p>By contrast the Gillespie algorithm is <em>event</em>-driven; it calculates
the time until the next event happens then progresses
time forward until that time and executes the event. This
means that an <em>infintesimally small</em> time increment $dt$ is never
approximated by a finite timestep $\Delta t$. It also has the added
advantage that each iteration of the algorithm responds to
a reaction or event meaning that computation is not wasted as in the traditional counterparts.</p>
<p>The implementation follows the simple steps</p>
<blockquote><ol>
<li>Generate two random numbers $r_1$, $r_2$ picked from a uniform distribution on $(0,1)$.</li>
<li><ul>
<li>Compute the propensity function $\alpha_i^m(t)$ for each node $i$ and reaction $m$.</li>
<li>Compute the total propensity for the system,
$$\begin{align}
\alpha_0 = \sum_{m=1}^{M}\sum_{i=1}^{N}\alpha_i^m(t). 
\end{align}$$ </li>
</ul>
</li>
<li>Compute the time until the next reaction takes place as 
$$\begin{align}
\tau = \frac{1}{\alpha_0}\log\left( \frac{1}{r_1} \right). 
\end{align}$$</li>
<li>Compute which reaction occurs at time $t+\tau$, i.e. find $k,j$ such that
$$\begin{align}
r_2 \geq \frac{1}{\alpha_0}\sum_{m=1}^{k-1}\sum_{i=1}^{j-1}\alpha_i^m(t) \hspace{1ex} \text{and} \hspace{1ex} r_2 < \frac{1}{\alpha_0}\sum_{m=1}^{k}\sum_{i=1}^{j}\alpha_i^m(t).
\end{align}$$</li>
<li>Update the node states and propensities for the $k$-th reaction of  the $j$-th node.</li>
<li>Repeat from step 1(a) from time $t+\tau$.</li>
</ol>
</blockquote>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Code">Code<a class="anchor-link" href="#Code">¶</a></h2><p>The model is implemented as a Python class which keeps track of the individual node states as well as the overall level of infected and susceptible nodes. The main functions are <em>RunIteration()</em> where the Gillespie algorithm is run, and <em>UpdatePropensity()</em> which calculates the propensities for nodes to become infected. You will see that there are in fact 5 seperate implementations of the <em>UpdatePropensity()</em> function. This is the computational bottleneck of the simulation and so, in the next section we explore the merits and caveats of these different implementations.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">SI_Simulation</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to simulate the SI Model.</span>
<span class="sd">    ===================================================</span>
<span class="sd">    Input: A - Network adjacency matrix (numpy array) or Networkx graph object.</span>
<span class="sd">           lam - Contagion parameter.</span>
<span class="sd">           gam - Spontaneous infection parameter.</span>
<span class="sd">           i0 - Initial infected fraction.</span>
<span class="sd">           prop - Propensity calculation method [ALL,TAKE,FANCY,LOOP,SLICE].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">lam</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">gam</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">i0</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>

        <span class="c1"># Network setup.</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">==</span><span class="n">nx</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">Graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">adj_matrix</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">A</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s2">&quot;Input an adjacency matrix or networkx object only.&quot;</span><span class="p">)</span>

        <span class="c1"># Model Parameters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lam</span> <span class="o">=</span> <span class="n">lam</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam</span> <span class="o">=</span> <span class="n">gam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="n">prop</span>

        <span class="c1"># Time-keeping.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Node numbers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        
        <span class="c1"># Node states.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
         
        <span class="c1"># Initial propensity setup.        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensityALL</span><span class="p">()</span> 
        
        <span class="c1"># Select which propensity scheme to use.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;ALL&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensityALL</span> 
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;FANCY&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensityFANCY</span> 
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;TAKE&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensityTAKE</span> 
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;SLICE&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensitySLICE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;LOOP&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensityLOOP</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="s2">&quot;Please specify a propensity scheme [ALL,TAKE,FANCY,LOOP,SLICE].&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">UpdatePropensityALL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IP</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">UpdatePropensityTAKE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_nodes</span><span class="p">):</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">IP</span><span class="p">[</span><span class="n">n_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>    
    
    <span class="k">def</span> <span class="nf">UpdatePropensityFANCY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_nodes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IP</span><span class="p">[</span><span class="n">n_nodes</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">n_nodes</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">n_nodes</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">UpdatePropensityLOOP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_nodes</span><span class="p">):</span>        
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">n_nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IP</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">UpdatePropensitySLICE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n_nodes</span><span class="p">):</span>        
        <span class="n">nmax</span><span class="p">,</span> <span class="n">nmin</span> <span class="o">=</span> <span class="n">n_nodes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_nodes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IP</span><span class="p">[</span><span class="n">nmin</span><span class="p">:</span><span class="n">nmax</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gam</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">nmin</span><span class="p">:</span><span class="n">nmax</span><span class="p">,:]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">nmin</span><span class="p">:</span><span class="n">nmax</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">RunIteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># Termination.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># 1. Generate random numbers r1,r2 uniformly distributed in (0,1)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        
        <span class="c1"># 2. Calculate alpha.</span>
        <span class="n">cumsum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IP</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># 3. Compute the time until the next reaction takes place.</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">r1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">+=</span> <span class="n">tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># 4. Compute which reaction takes place.</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumsum</span><span class="p">,</span><span class="n">r2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>

        <span class="c1"># 5. Update node states. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">index</span><span class="o">%</span><span class="k">self</span>.N] = 2
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            
        <span class="c1"># 6. Update propensities</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">index</span><span class="o">%</span><span class="k">self</span>.N])[0]
        <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">index</span><span class="o">%</span><span class="k">self</span>.N)
        
        <span class="bp">self</span><span class="o">.</span><span class="n">UpdatePropensity</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">RunToConvergence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">running</span><span class="p">:</span>
            <span class="n">running</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RunIteration</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">IntegrateSolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span>
        <span class="n">gam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lam</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
            <span class="n">xdot</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">gam</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">gam</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="k">return</span> <span class="n">xdot</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">deriv</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solution</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This framework is designed to be general. Provided the propensity of a reaction is properly calculated, and the network states updated then any number of reactions can be cast into this form, including dynamics which alter the structure of the network itself.</p>
<h2 id="Efficiency">Efficiency<a class="anchor-link" href="#Efficiency">¶</a></h2><p>In theory, this is the currently the most efficient way of implementing the model, however intricases in the Python language (and the Numpy package) require that more thought is given as to how it is written.</p>
<p>The most intensive aspect of the algorithm is the calculation of the propensities for each node (and reaction).
This can be written in terms of matrix multiplication.</p>
$$ \underline{\alpha} = (\gamma \textbf{1} + \lambda \textbf{A}\textbf{1}_{\{infected\}}) \circ \textbf{1}_{\{susceptible\}} $$<p>where $\circ$ is the element-wise vector multiplication and $(\textbf{1}_{\{infected\}})_i = 1$ if node $i$ is infected and $0$ otherwise. The indicator vector $\textbf{1}_{\{susceptible\}}$ is similarly defined. This definition calculates all the propensities however in most cases (particularly on sparse networks) when a node changes state only a small fraction of the nodes will change propensity.</p>
<p>The different implementations are:</p>
<p><strong>ALL</strong></p>
<p>Calculate all entries of $\alpha$ at each iteration.</p>
<p>Pros: Easy to write, no array copying, fixed number of calculations. 
Cons: Lots of duplication, especially on sparse networks.</p>
<p><strong>FANCY</strong></p>
<p>Calculate only effected entries of $\alpha$ at each iteration using Numpy's fancy indexing.</p>
<p>Pros: Easy to write, efficient. 
Cons: Creates a copy of each array which is sampled using fancy indexing.</p>
<p>This methodology is exactly what we want. The implementation in Numpy however means that a copy of the array is always generated which adds significant cost for non-sparse networks.</p>
<p><strong>TAKE</strong></p>
<p>Calculate only effected entries of $\alpha$ at each iteration using Numpy's take.</p>
<p>Pros: Efficient. 
Cons: Creates a copy of each array which is sampled using take.</p>
<p>This method is equivalent to fancy indexing however it bypasses some ambiguity in the fancy indexing syntax to allow for a more efficient implementation.</p>
<p><strong>LOOP</strong></p>
<p>Calculate only effected entries of $\alpha$ at each iteration using a native Python loop.</p>
<p>Pros: Easy to write, efficient. 
Cons: Native Python loops inherently slow.</p>
<p>A very basic approach to the problem. This is used as an upper bound to the problem.</p>
<p><strong>SLICE</strong></p>
<p>Calculate a subset of entries of $\alpha$ at each iteration using a Numpy slice.</p>
<p>Pros: Easy to write, no array copying. 
Cons: Not fully efficient, efficiency is variable.</p>
<p>This method is more of a cheat. It takes a minimal covering of the effected nodes and uses slicing to get the relevant rows of the matrix. Slicing in Numpy does not make a copy of the array which is a clear advantage.</p>
<p>We'll look at the simulation times for near-complete graphs (high degree):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [279]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">erdos_renyi_graph</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mf">0.95</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [280]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;TAKE&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 2.35 s per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [281]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;ALL&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 1.72 s per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [282]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;LOOP&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 18.8 s per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [283]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;FANCY&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 9.62 s per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [284]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;SLICE&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 1.66 s per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see that, for near-complete graphs the SLICE method is the fastest, followed closely by the ALL method. The TAKE method takes almost 50% more time again which is due to the copying previously mentioned. The FANCY index seems to have a large overhead given it is carrying out the exact same function as TAKE. The native Python LOOP is by contrast too slow to even consider. Conversely, we'll look at the behaviour on sparse networks (low degree):</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [285]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">erdos_renyi_graph</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [286]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;TAKE&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 200 ms per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [287]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;ALL&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 841 ms per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [288]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;LOOP&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 1.03 s per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [289]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;FANCY&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 592 ms per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [290]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">timeit</span>
model = SI_Simulation(G, lam=0.1, gam=0.05, i0=0.1, prop=&#39;SLICE&#39;)
model.RunToConvergence()
</pre></div>

</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loops, best of 3: 832 ms per loop
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can see that the TAKE function is by far the fastest in the low degree limit. With only a relatively small amount of data to be copied this undertaking does not outweigh the potentially huge gains over calculating all propensities.</p>
<p>These are single instances and so we should not take them as gospel. What we're interested in is when should we value one method over another? To investigate this we should look over a full range of values for repeated simulation, for which we'll need to import the timeit module (rather than using the in-built cell magic). An example statement would be something along the lines of:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">timeit</span> <span class="k">import</span> <span class="n">timeit</span>
<span class="n">num_sims</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">setup</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">from simulation import SI_Simulation</span>
<span class="s2">import networkx as nx</span>
<span class="s2">G = nx.erdos_renyi_graph(1000,0.5, seed=50)</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">model = SI_Simulation(G,lam=0.1, gam=0.05, i0=0.1, prop=&#39;TAKE&#39;)</span>
<span class="s2">model.RunToConvergence()</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">timeit</span><span class="p">(</span><span class="n">stmt</span><span class="o">=</span><span class="n">stmt</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">num_sims</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, computing simulation times for across networks of varying size and degree we can see when we should use either method. The dashed lines are for the ALL method and the solid lines represent the TAKE method.</p>
<p><img alt="Performance" src="../../../../../images/performance.png" title="Performance" /></p>
<p>For small networks there is little in terms of performance between the two implementations. As we increase the system size we see that the TAKE method performs significantly faster for small $\langle k \rangle / N$, and significantly slower for large $\langle k \rangle / N$. From this quick study it seems sensible to use TAKE when $\langle k \rangle / N < 0.5$. This figure is dependent the propensity calculation as well as the underlying tradeoff between calculation and array copying and so should not be taken as gospel. For the SI model one would most likely use the TAKE method as most human contact networks are sparse in nature.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Concluding-Remarks">Concluding Remarks<a class="anchor-link" href="#Concluding-Remarks">¶</a></h2><p>Epidemic modelling has exploded in recent years. Not long ago this simple model was once state-of-the-art. Variants now combine in a number of different factors; edge creation/breaking, vaccination, behavioural changes, travel, susceptibility to name just a few. Regardless of the complexity the underlying principles often boil down to the simple contagion principle in this model. The mathematics of these more complex models is lagging behind and large-scale simulation is used to understand their behaviours. It is therefore extremely important that simulation is accurate and efficient.</p>
<p>From a technical standpoint this Python implementation of the simulation allows for suitable trade-off with the tools used, but I am keen to improve this framework where possible. The developers of Numpy have stated that fancy indexing will always copy an array and there are no plans to change it. There are some other avenues to explore such as Cython, or even a full C implementation. I am however interested to see if anyone has any other possible implementations (in Python or otherwise) which would significantly improve on this.</p>
<p>Understandably, this post has been on the technical side but if you've made it this far then I hope you've found it interesting and clear. Feel free to contact me with any questions.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="References">References<a class="anchor-link" href="#References">¶</a></h4><hr>
<p>[1]: SocioPatterns: <a href="http://www.sociopatterns.org/datasets/">http://www.sociopatterns.org/datasets/</a></p>
<p>[2]: The solution of the differential equations
    \begin{align<em>}
    \frac{dS}{dt} &= -\gamma S - \lambda \frac{k}{N} S I,\
    \frac{dI}{dt} &= +\gamma S + \lambda \frac{k}{N} S I,
    \end{align</em>}
    where $k$ is the average degree of the network. Left as an exercise.</p>
<p>[3]: M. A. Gibson and J. Bruck. <em>Effcient exact stochastic simulation of chemical systems with many species and many
channels.</em> The Journal of Physical Chemistry A</p>
<p>[4]: M. Rathinam, L. R. Petzold, Y. Cao, and D. T. Gillespie. <em>Stiffness in stochastic chemically reacting systems: The
implicit tau-leaping method.</em> The Journal of Chemical Physics</p>
</hr></div>
</div>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>

            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'empiricalstateofmind'; // required: replace example with your forum shortname

                    var disqus_identifier = 'gillespie-epidemics';
                /* * * var disqus_url = '../../../../../articles/2014/12/19/gillespie-epidemics/'; * * */

            var disqus_config = function () {
                this.language = "en";
                this.page.identifier = 'gillespie-epidemics';
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var d = document;
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                /* * *  dsq.async = true; * * */
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                dsq.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(dsq);
                /* * * (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); * * */
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://twitter.com/EmpiricalSOM"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
                <li class="list-group-item"><a href="https://www.linkedin.com/pub/andrew-mellor/49/74b/842"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                <li class="list-group-item"><a href="https://github.com/empiricalstateofmind"><i class="fa fa-github-square fa-lg"></i> github</a></li>
                <li class="list-group-item"><a href="https://andrewmellor.co.uk/blog/feeds/all.atom.xml"><i class="fa fa-rss-square fa-lg"></i> rss</a></li>
              </ul>
            </li>

            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="../../../../../articles/2019/05/09/machine-learning/">
                            Machine Learning and Mathematics: Collaborators or Competitors?
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../../../../../articles/2016/10/18/mapping-climbs/">
                            Mapping the Top Cycling Climbs in the UK with Folium
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../../../../../articles/2016/07/27/scientific-env/">
                            Finding a Scientific Working Environment In Python
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../../../../../articles/2015/04/30/easy-parallel/">
                            Easy Parallel Computing with IPython
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../../../../../articles/2014/12/19/gillespie-epidemics/">
                            Network Dynamics with Python and the Gillespie Algorithm: An Epidemic Example
                        </a>
                    </li>
                </ul>
            </li>


            <li class="list-group-item"><a href="../../../../../"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                    <li class="list-group-item tag-1">
                        <a href="../../../../../tag/python.html">
                            Python
                        </a>
                    </li>
                    <li class="list-group-item tag-2">
                        <a href="../../../../../tag/ipython.html">
                            IPython
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/anaconda.html">
                            Anaconda
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/conda.html">
                            Conda
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/pytorch.html">
                            PyTorch
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/deep-neural-networks.html">
                            Deep Neural Networks
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/simulation.html">
                            Simulation
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/neural-odes.html">
                            Neural ODEs
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/virtualenv.html">
                            virtualenv
                        </a>
                    </li>
                    <li class="list-group-item tag-4">
                        <a href="../../../../../tag/mapping.html">
                            Mapping
                        </a>
                    </li>
                </ul>
            </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2019 Andrew Mellor
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="../../../../../theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../../../../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../../../../../theme/js/respond.min.js"></script>

<!-- include 'includes/disqus_script.html' -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-49010624-4']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5477a96408ae534a"></script>
</body>
</html>